# Add new issues to the correct project
name: '.Platform: Assign Issue to Project'

on:
  workflow_dispatch:
  issues:
    types:
      - opened

env:
  GITHUB_TOKEN: ${{ github.token }}

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  add-to-project:
    name: Add Issues to Projects
    runs-on: ubuntu-latest
    steps:
      - name: 'Add Bug to Bug Board'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'bug')
        shell: pwsh
        run: |
          gh api graphql -f query='
            mutation($project:ID!, $issue:ID!) {
              addProjectV2ItemById(input: {projectId: $project, contentId: $issue}) {
                item {
                  id
                }
              }
            }' -f project="PVT_kwDOAGhwUs4AJa3a" -f issue=${{ github.event.issue.node_id }} --jq '.data.addProjectV2ItemById.projectV2Item.id'
      - name: 'Add Issues to Backlog Board'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        if: |
          contains(github.event.issue.labels.*.name, 'enhancement')
        shell: pwsh
        run: |
          gh api graphql -f query='
            mutation($project:ID!, $issue:ID!) {
              addProjectV2ItemById(input: {projectId: $project, contentId: $issue}) {
                item {
                  id
                }
              }
            }' -f project="PVT_kwDOAGhwUs4AJa3N" -f issue=${{ github.event.issue.node_id }} --jq '.data.addProjectV2ItemById.projectV2Item.id'
