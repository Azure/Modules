{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.4.613.9944",
      "templateHash": "6140107859167184534"
    }
  },
  "parameters": {
    "circuitName": {
      "type": "string",
      "metadata": {
        "description": "Required. This is the name of the ExpressRoute circuit"
      }
    },
    "serviceProviderName": {
      "type": "string",
      "metadata": {
        "description": "Required. This is the name of the ExpressRoute Service Provider. It must exactly match one of the Service Providers from List ExpressRoute Service Providers API call."
      }
    },
    "peeringLocation": {
      "type": "string",
      "metadata": {
        "description": "Required. This is the name of the peering location and not the ARM resource location. It must exactly match one of the available peering locations from List ExpressRoute Service Providers API call."
      }
    },
    "bandwidthInMbps": {
      "type": "int",
      "metadata": {
        "description": "Required. This is the bandwidth in Mbps of the circuit being created. It must exactly match one of the available bandwidth offers List ExpressRoute Service Providers API call."
      }
    },
    "skuTier": {
      "type": "string",
      "defaultValue": "Standard",
      "allowedValues": [
        "Standard",
        "Premium"
      ],
      "metadata": {
        "description": "Required. Chosen SKU Tier of ExpressRoute circuit. Choose from Premium or Standard SKU tiers."
      }
    },
    "skuFamily": {
      "type": "string",
      "defaultValue": "MeteredData",
      "allowedValues": [
        "MeteredData",
        "UnlimitedData"
      ],
      "metadata": {
        "description": "Required. Chosen SKU family of ExpressRoute circuit. Choose from MeteredData or UnlimitedData SKU families."
      }
    },
    "peering": {
      "type": "bool",
      "defaultValue": false,
      "allowedValues": [
        true,
        false
      ],
      "metadata": {
        "description": "Optional. Enabled BGP peering type for the Circuit."
      }
    },
    "peeringType": {
      "type": "string",
      "defaultValue": "AzurePrivatePeering",
      "allowedValues": [
        "AzurePrivatePeering",
        "MicrosoftPeering"
      ],
      "metadata": {
        "description": "Optional. BGP peering type for the Circuit. Choose from AzurePrivatePeering, AzurePublicPeering or MicrosoftPeering."
      }
    },
    "sharedKey": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. The shared key for peering configuration. Router does MD5 hash comparison to validate the packets sent by BGP connection. This parameter is optional and can be removed from peering configuration if not required."
      }
    },
    "peerASN": {
      "type": "int",
      "defaultValue": 0,
      "metadata": {
        "description": "Optional. The autonomous system number of the customer/connectivity provider."
      }
    },
    "primaryPeerAddressPrefix": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. A /30 subnet used to configure IP addresses for interfaces on Link1."
      }
    },
    "secondaryPeerAddressPrefix": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. A /30 subnet used to configure IP addresses for interfaces on Link2."
      }
    },
    "vlanId": {
      "type": "int",
      "defaultValue": 0,
      "metadata": {
        "description": "Optional. Specifies the identifier that is used to identify the customer."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Optional. Location for all resources."
      }
    },
    "diagnosticLogsRetentionInDays": {
      "type": "int",
      "defaultValue": 365,
      "maxValue": 365,
      "minValue": 0,
      "metadata": {
        "description": "Optional. Specifies the number of days that logs will be kept for; a value of 0 will retain data indefinitely."
      }
    },
    "diagnosticStorageAccountId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Resource identifier of the Diagnostic Storage Account."
      }
    },
    "workspaceId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Resource identifier of Log Analytics."
      }
    },
    "eventHubAuthorizationRuleId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Resource ID of the event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
      }
    },
    "eventHubName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Name of the event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category."
      }
    },
    "lockForDeletion": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Optional. Switch to lock ExpressRoute Circuit from deletion."
      }
    },
    "roleAssignments": {
      "type": "array",
      "defaultValue": [],
      "metadata": {
        "description": "Optional. Array of role assignment objects that contain the 'roleDefinitionIdOrName' and 'principalId' to define RBAC role assignments on this resource. In the roleDefinitionIdOrName attribute, you can provide either the display name of the role definition, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'"
      }
    },
    "tags": {
      "type": "object",
      "defaultValue": {},
      "metadata": {
        "description": "Optional. Tags of the resource."
      }
    },
    "cuaId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Customer Usage Attribution id (GUID). This GUID must be previously registered"
      }
    }
  },
  "functions": [],
  "variables": {
    "diagnosticsMetrics": [
      {
        "category": "AllMetrics",
        "timeGrain": null,
        "enabled": true,
        "retentionPolicy": {
          "enabled": true,
          "days": "[parameters('diagnosticLogsRetentionInDays')]"
        }
      }
    ],
    "diagnosticsLogs": [
      {
        "category": "PeeringRouteLog",
        "enabled": true,
        "retentionPolicy": {
          "enabled": true,
          "days": "[parameters('diagnosticLogsRetentionInDays')]"
        }
      }
    ],
    "peeringConfiguration": [
      {
        "name": "[parameters('peeringType')]",
        "properties": {
          "peeringType": "[parameters('peeringType')]",
          "sharedKey": "[parameters('sharedKey')]",
          "peerASN": "[parameters('peerASN')]",
          "primaryPeerAddressPrefix": "[parameters('primaryPeerAddressPrefix')]",
          "secondaryPeerAddressPrefix": "[parameters('secondaryPeerAddressPrefix')]",
          "vlanId": "[parameters('vlanId')]"
        }
      }
    ],
    "builtInRoleNames": {
      "AcrDelete": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11', subscription().subscriptionId)]",
      "AcrImageSigner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/6cef56e8-d556-48e5-a04f-b8e64114680f', subscription().subscriptionId)]",
      "AcrPull": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/7f951dda-4ed3-4680-a7ca-43fe172d538d', subscription().subscriptionId)]",
      "AcrPush": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8311e382-0749-4cb8-b61a-304f252e45ec', subscription().subscriptionId)]",
      "AcrQuarantineReader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/cdda3590-29a3-44f6-95f2-9f980659eb04', subscription().subscriptionId)]",
      "AcrQuarantineWriter": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c8d4ff99-41c3-41a8-9f60-21dfdad59608', subscription().subscriptionId)]",
      "API Management Service Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c', subscription().subscriptionId)]",
      "API Management Service Operator Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/e022efe7-f5ba-4159-bbe4-b44f577e9b61', subscription().subscriptionId)]",
      "API Management Service Reader Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/71522526-b88f-4d52-b57f-d31fc3546d0d', subscription().subscriptionId)]",
      "App Configuration Data Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5ae67dd6-50cb-40e7-96ff-dc2bfa4b606b', subscription().subscriptionId)]",
      "App Configuration Data Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/516239f1-63e1-4d78-a4de-a74fb236a071', subscription().subscriptionId)]",
      "Application Insights Component Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e', subscription().subscriptionId)]",
      "Application Insights Snapshot Debugger": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/08954f03-6346-4c2e-81c0-ec3a5cfae23b', subscription().subscriptionId)]",
      "Attestation Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/bbf86eb8-f7b4-4cce-96e4-18cddf81d86e', subscription().subscriptionId)]",
      "Attestation Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/fd1bd22b-8476-40bc-a0bc-69b95687b9f3', subscription().subscriptionId)]",
      "Automation Job Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4fe576fe-1146-4730-92eb-48519fa6bf9f', subscription().subscriptionId)]",
      "Automation Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/d3881f73-407a-4167-8283-e981cbba0404', subscription().subscriptionId)]",
      "Automation Runbook Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5fb5aef8-1081-4b8e-bb16-9d5d0385bab5', subscription().subscriptionId)]",
      "Avere Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4f8fab4f-1852-4a58-a46a-8eaf358af14a', subscription().subscriptionId)]",
      "Avere Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c025889f-8102-4ebf-b32c-fc0c6f0c6bd9', subscription().subscriptionId)]",
      "Azure Connected Machine Onboarding": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b64e21ea-ac4e-4cdf-9dc9-5b892992bee7', subscription().subscriptionId)]",
      "Azure Connected Machine Resource Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/cd570a14-e51a-42ad-bac8-bafd67325302', subscription().subscriptionId)]",
      "Azure Digital Twins Owner (Preview)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/bcd981a7-7f74-457b-83e1-cceb9e632ffe', subscription().subscriptionId)]",
      "Azure Digital Twins Reader (Preview)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/d57506d4-4c8d-48b1-8587-93c323f6a5a3', subscription().subscriptionId)]",
      "Azure Event Hubs Data Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/f526a384-b230-433a-b45c-95f59c4a2dec', subscription().subscriptionId)]",
      "Azure Event Hubs Data Receiver": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a638d3c7-ab3a-418d-83e6-5f17a39d4fde', subscription().subscriptionId)]",
      "Azure Event Hubs Data Sender": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/2b629674-e913-4c01-ae53-ef4638d8f975', subscription().subscriptionId)]",
      "Azure Kubernetes Service Cluster Admin Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/0ab0b1a8-8aac-4efd-b8c2-3ee1fb270be8', subscription().subscriptionId)]",
      "Azure Kubernetes Service Cluster User Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4abbcc35-e782-43d8-92c5-2d3f1bd2253f', subscription().subscriptionId)]",
      "Azure Kubernetes Service Contributor Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ed7f3fbd-7b88-4dd4-9017-9adb7ce333f8', subscription().subscriptionId)]",
      "Azure Maps Data Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8f5e0ce6-4f7b-4dcf-bddf-e6f48634a204', subscription().subscriptionId)]",
      "Azure Maps Data Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/423170ca-a8f6-4b0f-8487-9e4eb8f49bfa', subscription().subscriptionId)]",
      "Azure Sentinel Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ab8e14d6-4a74-4a29-9ba8-549422addade', subscription().subscriptionId)]",
      "Azure Sentinel Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8d289c81-5878-46d4-8554-54e1e3d8b5cb', subscription().subscriptionId)]",
      "Azure Sentinel Responder": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/3e150937-b8fe-4cfb-8069-0eaf05ecd056', subscription().subscriptionId)]",
      "Azure Service Bus Data Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/090c5cfd-751d-490a-894a-3ce6f1109419', subscription().subscriptionId)]",
      "Azure Service Bus Data Receiver": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4f6d3b9b-027b-4f4c-9142-0e5a2a2247e0', subscription().subscriptionId)]",
      "Azure Service Bus Data Sender": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/69a216fc-b8fb-44d8-bc22-1f3c2cd27a39', subscription().subscriptionId)]",
      "Azure Stack Registration Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/6f12a6df-dd06-4f3e-bcb1-ce8be600526a', subscription().subscriptionId)]",
      "Backup Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b', subscription().subscriptionId)]",
      "Backup Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/00c29273-979b-4161-815c-10b084fb9324', subscription().subscriptionId)]",
      "Backup Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a795c7a0-d4a2-40c1-ae25-d81f01202912', subscription().subscriptionId)]",
      "Billing Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/fa23ad8b-c56e-40d8-ac0c-ce449e1d2c64', subscription().subscriptionId)]",
      "BizTalk Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5e3c6656-6cfa-4708-81fe-0de47ac73342', subscription().subscriptionId)]",
      "Blockchain Member Node Access (Preview)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/31a002a1-acaf-453e-8a5b-297c9ca1ea24', subscription().subscriptionId)]",
      "Blueprint Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/41077137-e803-4205-871c-5a86e6a753b4', subscription().subscriptionId)]",
      "Blueprint Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/437d2ced-4a38-4302-8479-ed2bcb43d090', subscription().subscriptionId)]",
      "CDN Endpoint Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/426e0c7f-0c7e-4658-b36f-ff54d6c29b45', subscription().subscriptionId)]",
      "CDN Endpoint Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/871e35f6-b5c1-49cc-a043-bde969a0f2cd', subscription().subscriptionId)]",
      "CDN Profile Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ec156ff8-a8d1-4d15-830c-5b80698ca432', subscription().subscriptionId)]",
      "CDN Profile Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8f96442b-4075-438f-813d-ad51ab4019af', subscription().subscriptionId)]",
      "Classic Network Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b34d265f-36f7-4a0d-a4d4-e158ca92e90f', subscription().subscriptionId)]",
      "Classic Storage Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/86e8f5dc-a6e9-4c67-9d15-de283e8eac25', subscription().subscriptionId)]",
      "Classic Storage Account Key Operator Service Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/985d6b00-f706-48f5-a6fe-d0ca12fb668d', subscription().subscriptionId)]",
      "Classic Virtual Machine Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/d73bb868-a0df-4d4d-bd69-98a00b01fccb', subscription().subscriptionId)]",
      "ClearDB MySQL DB Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/9106cda0-8a86-4e81-b686-29a22c54effe', subscription().subscriptionId)]",
      "Cognitive Services Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/25fbc0a9-bd7c-42a3-aa1a-3b75d497ee68', subscription().subscriptionId)]",
      "Cognitive Services Custom Vision Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c1ff6cc2-c111-46fe-8896-e0ef812ad9f3', subscription().subscriptionId)]",
      "Cognitive Services Custom Vision Deployment": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5c4089e1-6d96-4d2f-b296-c1bc7137275f', subscription().subscriptionId)]",
      "Cognitive Services Custom Vision Labeler": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/88424f51-ebe7-446f-bc41-7fa16989e96c', subscription().subscriptionId)]",
      "Cognitive Services Custom Vision Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/93586559-c37d-4a6b-ba08-b9f0940c2d73', subscription().subscriptionId)]",
      "Cognitive Services Custom Vision Trainer": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/0a5ae4ab-0d65-4eeb-be61-29fc9b54394b', subscription().subscriptionId)]",
      "Cognitive Services Data Reader (Preview)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b59867f0-fa02-499b-be73-45a86b5b3e1c', subscription().subscriptionId)]",
      "Cognitive Services QnA Maker Editor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/f4cc2bf9-21be-47a1-bdf1-5c5804381025', subscription().subscriptionId)]",
      "Cognitive Services QnA Maker Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/466ccd10-b268-4a11-b098-b4849f024126', subscription().subscriptionId)]",
      "Cognitive Services User": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908', subscription().subscriptionId)]",
      "Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c', subscription().subscriptionId)]",
      "Cosmos DB Account Reader Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/fbdf93bf-df7d-467e-a4d2-9458aa1360c8', subscription().subscriptionId)]",
      "Cosmos DB Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/230815da-be43-4aae-9cb4-875f7bd000aa', subscription().subscriptionId)]",
      "CosmosBackupOperator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/db7b14f2-5adf-42da-9f96-f2ee17bab5cb', subscription().subscriptionId)]",
      "Cost Management Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/434105ed-43f6-45c7-a02f-909b2ba83430', subscription().subscriptionId)]",
      "Cost Management Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/72fafb9e-0641-4937-9268-a91bfd8191a3', subscription().subscriptionId)]",
      "Data Box Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/add466c9-e687-43fc-8d98-dfcf8d720be5', subscription().subscriptionId)]",
      "Data Box Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/028f4ed7-e2a9-465e-a8f4-9c0ffdfdc027', subscription().subscriptionId)]",
      "Data Factory Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/673868aa-7521-48a0-acc6-0f60742d39f5', subscription().subscriptionId)]",
      "Data Lake Analytics Developer": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/47b7735b-770e-4598-a7da-8b91488b4c88', subscription().subscriptionId)]",
      "Data Purger": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/150f5e0c-0603-4f03-8c7f-cf70034c4e90', subscription().subscriptionId)]",
      "Desktop Virtualization User": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/1d18fff3-a72a-46b5-b4a9-0b38a3cd7e63', subscription().subscriptionId)]",
      "DevTest Labs User": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/76283e04-6283-4c54-8f91-bcf1374a3c64', subscription().subscriptionId)]",
      "DNS Zone Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/befefa01-2a29-4197-83a8-272ff33ce314', subscription().subscriptionId)]",
      "DocumentDB Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5bd9cd88-fe45-4216-938b-f97437e15450', subscription().subscriptionId)]",
      "EventGrid EventSubscription Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/428e0ff0-5e57-4d9c-a221-2c70d0e0a443', subscription().subscriptionId)]",
      "EventGrid EventSubscription Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/2414bbcf-6497-4faf-8c65-045460748405', subscription().subscriptionId)]",
      "Experimentation Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/7f646f1b-fa08-80eb-a33b-edd6ce5c915c', subscription().subscriptionId)]",
      "Experimentation Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/7f646f1b-fa08-80eb-a22b-edd6ce5c915c', subscription().subscriptionId)]",
      "Experimentation Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/49632ef5-d9ac-41f4-b8e7-bbe587fa74a1', subscription().subscriptionId)]",
      "FHIR Data Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5a1fc7df-4bf1-4951-a576-89034ee01acd', subscription().subscriptionId)]",
      "FHIR Data Exporter": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/3db33094-8700-4567-8da5-1501d4e7e843', subscription().subscriptionId)]",
      "FHIR Data Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4c8d0bbc-75d3-4935-991f-5f3c56d81508', subscription().subscriptionId)]",
      "FHIR Data Writer": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/3f88fce4-5892-4214-ae73-ba5294559913', subscription().subscriptionId)]",
      "Graph Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b60367af-1334-4454-b71e-769d9a4f83d9', subscription().subscriptionId)]",
      "HDInsight Cluster Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/61ed4efc-fab3-44fd-b111-e24485cc132a', subscription().subscriptionId)]",
      "HDInsight Domain Services Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8d8d5a11-05d3-4bda-a417-a08778121c7c', subscription().subscriptionId)]",
      "Hierarchy Settings Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/350f8d15-c687-4448-8ae1-157740a3936d', subscription().subscriptionId)]",
      "Hybrid Server Onboarding": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5d1e5ee4-7c68-4a71-ac8b-0739630a3dfb', subscription().subscriptionId)]",
      "Hybrid Server Resource Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/48b40c6e-82e0-4eb3-90d5-19e40f49b624', subscription().subscriptionId)]",
      "Integration Service Environment Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a41e2c5b-bd99-4a07-88f4-9bf657a760b8', subscription().subscriptionId)]",
      "Integration Service Environment Developer": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c7aa55d3-1abb-444a-a5ca-5e51e485d6ec', subscription().subscriptionId)]",
      "Intelligent Systems Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/03a6d094-3444-4b3d-88af-7477090a9e5e', subscription().subscriptionId)]",
      "Key Vault Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/f25e0fa2-a7c8-4377-a976-54943a77a395', subscription().subscriptionId)]",
      "Knowledge Consumer": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ee361c5d-f7b5-4119-b4b6-892157c8f64c', subscription().subscriptionId)]",
      "Kubernetes Cluster - Azure Arc Onboarding": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/34e09817-6cbe-4d01-b1a2-e0eac5743d41', subscription().subscriptionId)]",
      "Lab Creator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b97fb8bc-a8b2-4522-a38b-dd33c7e65ead', subscription().subscriptionId)]",
      "Log Analytics Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293', subscription().subscriptionId)]",
      "Log Analytics Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/73c42c96-874c-492b-b04d-ab87d138a893', subscription().subscriptionId)]",
      "Logic App Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/87a39d53-fc1b-424a-814c-f7e04687dc9e', subscription().subscriptionId)]",
      "Logic App Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/515c2055-d9d4-4321-b1b9-bd0c9a0f79fe', subscription().subscriptionId)]",
      "Managed Application Contributor Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/641177b8-a67a-45b9-a033-47bc880bb21e', subscription().subscriptionId)]",
      "Managed Application Operator Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c7393b34-138c-406f-901b-d8cf2b17e6ae', subscription().subscriptionId)]",
      "Managed Applications Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b9331d33-8a36-4f8c-b097-4f54124fdb44', subscription().subscriptionId)]",
      "Managed Identity Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/e40ec5ca-96e0-45a2-b4ff-59039f2c2b59', subscription().subscriptionId)]",
      "Managed Identity Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830', subscription().subscriptionId)]",
      "Managed Services Registration assignment Delete ": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/91c1777a-f3dc-4fae-b103-61d183457e46', subscription().subscriptionId)]",
      "Management Group Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5d58bcaf-24a5-4b20-bdb6-eed9f69fbe4c', subscription().subscriptionId)]",
      "Management Group Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ac63b705-f282-497d-ac71-919bf39d939d', subscription().subscriptionId)]",
      "Marketplace Admin": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/dd920d6d-f481-47f1-b461-f338c46b2d9f', subscription().subscriptionId)]",
      "Monitoring Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa', subscription().subscriptionId)]",
      "Monitoring Metrics Publisher": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/3913510d-42f4-4e42-8a64-420c390055eb', subscription().subscriptionId)]",
      "Monitoring Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/43d0d8ad-25c7-4714-9337-8ba259a9fe05', subscription().subscriptionId)]",
      "Network Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7', subscription().subscriptionId)]",
      "New Relic APM Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5d28c62d-5b37-4476-8438-e587778df237', subscription().subscriptionId)]",
      "Object Understanding Account Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4dd61c23-6743-42fe-a388-d8bdd41cb745', subscription().subscriptionId)]",
      "Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635', subscription().subscriptionId)]",
      "Policy Insights Data Writer (Preview)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/66bb4e9e-b016-4a94-8249-4c0511c2be84', subscription().subscriptionId)]",
      "Private DNS Zone Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b12aa53e-6015-4669-85d0-8515ebb3ae7f', subscription().subscriptionId)]",
      "Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7', subscription().subscriptionId)]",
      "Reader and Data Access": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c12c1c16-33a1-487b-954d-41c89c60f349', subscription().subscriptionId)]",
      "Redis Cache Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/e0f68234-74aa-48ed-b826-c38b57376e17', subscription().subscriptionId)]",
      "Remote Rendering Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/3df8b902-2a6f-47c7-8cc5-360e9b272a7e', subscription().subscriptionId)]",
      "Remote Rendering Client": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/d39065c4-c120-43c9-ab0a-63eed9795f0a', subscription().subscriptionId)]",
      "Resource Policy Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/36243c78-bf99-498c-9df9-86d9f8d28608', subscription().subscriptionId)]",
      "Scheduler Job Collections Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/188a0f2f-5c9e-469b-ae67-2aa5ce574b94', subscription().subscriptionId)]",
      "Search Service Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/7ca78c08-252a-4471-8644-bb5ff32d4ba0', subscription().subscriptionId)]",
      "Security Admin": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd', subscription().subscriptionId)]",
      "Security Assessment Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/612c2aa1-cb24-443b-ac28-3ab7272de6f5', subscription().subscriptionId)]",
      "Security Manager (Legacy)": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/e3d13bf0-dd5a-482e-ba6b-9b8433878d10', subscription().subscriptionId)]",
      "Security Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/39bc4728-0917-49c7-9d2c-d95423bc2eb4', subscription().subscriptionId)]",
      "SignalR AccessKey Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/04165923-9d83-45d5-8227-78b77b0a687e', subscription().subscriptionId)]",
      "SignalR Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8cf5e20a-e4b2-4e9d-b3a1-5ceb692c2761', subscription().subscriptionId)]",
      "Site Recovery Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/6670b86e-a3f7-4917-ac9b-5d6ab1be4567', subscription().subscriptionId)]",
      "Site Recovery Operator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/494ae006-db33-4328-bf46-533a6560a3ca', subscription().subscriptionId)]",
      "Site Recovery Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/dbaa88c4-0c30-4179-9fb3-46319faa6149', subscription().subscriptionId)]",
      "Spatial Anchors Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8bbe83f1-e2a6-4df7-8cb4-4e04d4e5c827', subscription().subscriptionId)]",
      "Spatial Anchors Account Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/70bbe301-9835-447d-afdd-19eb3167307c', subscription().subscriptionId)]",
      "Spatial Anchors Account Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/5d51204f-eb77-4b1c-b86a-2ec626c49413', subscription().subscriptionId)]",
      "SQL DB Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/9b7fa17d-e63e-47b0-bb0a-15c516ac86ec', subscription().subscriptionId)]",
      "SQL Managed Instance Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4939a1f6-9ae0-4e48-a1e0-f2cbe897382d', subscription().subscriptionId)]",
      "SQL Security Manager": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3', subscription().subscriptionId)]",
      "SQL Server Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437', subscription().subscriptionId)]",
      "Storage Account Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab', subscription().subscriptionId)]",
      "Storage Account Key Operator Service Role": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/81a9662b-bebf-436f-a333-f67b29880f12', subscription().subscriptionId)]",
      "Storage Blob Data Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/ba92f5b4-2d11-453d-a403-e96b0029c9fe', subscription().subscriptionId)]",
      "Storage Blob Data Owner": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b7e6dc6d-f1e8-4753-8033-0f276bb0955b', subscription().subscriptionId)]",
      "Storage Blob Data Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/2a2b9908-6ea1-4ae2-8e65-a410df84e7d1', subscription().subscriptionId)]",
      "Storage Blob Delegator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/db58b8e5-c6ad-4a2a-8342-4190687cbf4a', subscription().subscriptionId)]",
      "Storage File Data SMB Share Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/0c867c2a-1d8c-454a-a3db-ab2ea1bdc8bb', subscription().subscriptionId)]",
      "Storage File Data SMB Share Elevated Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a7264617-510b-434b-a828-9731dc254ea7', subscription().subscriptionId)]",
      "Storage File Data SMB Share Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/aba4ae5f-2193-4029-9191-0cb91df5e314', subscription().subscriptionId)]",
      "Storage Queue Data Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/974c5e8b-45b9-4653-ba55-5f855dd0fb88', subscription().subscriptionId)]",
      "Storage Queue Data Message Processor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8a0f0c08-91a1-4084-bc3d-661d67233fed', subscription().subscriptionId)]",
      "Storage Queue Data Message Sender": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/c6a89b2d-59bc-44d0-9896-0f6e12d7b80a', subscription().subscriptionId)]",
      "Storage Queue Data Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/19e7f393-937e-4f77-808e-94535e297925', subscription().subscriptionId)]",
      "Support Request Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/cfd33db0-3dd1-45e3-aa9d-cdbdf3b6f24e', subscription().subscriptionId)]",
      "Tag Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/4a9ae827-6dc8-4573-8ac7-8239d42aa03f', subscription().subscriptionId)]",
      "Traffic Manager Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/a4b10055-b0c7-44c2-b00f-c7b5b3550cf7', subscription().subscriptionId)]",
      "User Access Administrator": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9', subscription().subscriptionId)]",
      "Virtual Machine Administrator Login": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/1c0163c0-47e6-4577-8991-ea5c82e286e4', subscription().subscriptionId)]",
      "Virtual Machine Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c', subscription().subscriptionId)]",
      "Virtual Machine User Login": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/fb879df8-f326-4884-b1cf-06f3ad86be52', subscription().subscriptionId)]",
      "Web Plan Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b', subscription().subscriptionId)]",
      "Website Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/de139f84-1756-47ae-9be6-808fbbe84772', subscription().subscriptionId)]",
      "Workbook Contributor": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/e8ddcd69-c73f-4f9f-9844-4100522f16ad', subscription().subscriptionId)]",
      "Workbook Reader": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/b279062a-9be3-42a0-92ae-8b3cf002ec4d', subscription().subscriptionId)]"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Network/expressRouteCircuits",
      "apiVersion": "2021-02-01",
      "name": "[parameters('circuitName')]",
      "location": "[parameters('location')]",
      "tags": "[parameters('tags')]",
      "sku": {
        "name": "[format('{0}_{1}', parameters('skuTier'), parameters('skuFamily'))]",
        "tier": "[parameters('skuTier')]",
        "family": "[parameters('skuFamily')]"
      },
      "properties": {
        "serviceProviderProperties": {
          "serviceProviderName": "[parameters('serviceProviderName')]",
          "peeringLocation": "[parameters('peeringLocation')]",
          "bandwidthInMbps": "[parameters('bandwidthInMbps')]"
        },
        "peerings": "[if(parameters('peering'), variables('peeringConfiguration'), json('null'))]"
      }
    },
    {
      "condition": "[parameters('lockForDeletion')]",
      "type": "Microsoft.Authorization/locks",
      "apiVersion": "2016-09-01",
      "scope": "[format('Microsoft.Network/expressRouteCircuits/{0}', parameters('circuitName'))]",
      "name": "[format('{0}-doNotDelete', parameters('circuitName'))]",
      "properties": {
        "level": "CanNotDelete"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Network/expressRouteCircuits', parameters('circuitName'))]"
      ]
    },
    {
      "condition": "[or(or(or(not(empty(parameters('diagnosticStorageAccountId'))), not(empty(parameters('workspaceId')))), not(empty(parameters('eventHubAuthorizationRuleId')))), not(empty(parameters('eventHubName'))))]",
      "type": "Microsoft.Insights/diagnosticSettings",
      "apiVersion": "2017-05-01-preview",
      "scope": "[format('Microsoft.Network/expressRouteCircuits/{0}', parameters('circuitName'))]",
      "name": "[format('{0}-diagnosticSettings', parameters('circuitName'))]",
      "properties": {
        "storageAccountId": "[if(empty(parameters('diagnosticStorageAccountId')), json('null'), parameters('diagnosticStorageAccountId'))]",
        "workspaceId": "[if(empty(parameters('workspaceId')), json('null'), parameters('workspaceId'))]",
        "eventHubAuthorizationRuleId": "[if(empty(parameters('eventHubAuthorizationRuleId')), json('null'), parameters('eventHubAuthorizationRuleId'))]",
        "eventHubName": "[if(empty(parameters('eventHubName')), json('null'), parameters('eventHubName'))]",
        "metrics": "[if(and(and(and(empty(parameters('diagnosticStorageAccountId')), empty(parameters('workspaceId'))), empty(parameters('eventHubAuthorizationRuleId'))), empty(parameters('eventHubName'))), json('null'), variables('diagnosticsMetrics'))]",
        "logs": "[if(and(and(and(empty(parameters('diagnosticStorageAccountId')), empty(parameters('workspaceId'))), empty(parameters('eventHubAuthorizationRuleId'))), empty(parameters('eventHubName'))), json('null'), variables('diagnosticsLogs'))]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Network/expressRouteCircuits', parameters('circuitName'))]"
      ]
    },
    {
      "condition": "[not(empty(parameters('cuaId')))]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2019-10-01",
      "name": "[format('pid-{0}', parameters('cuaId'))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {},
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.4.613.9944",
              "templateHash": "11855874804898679700"
            }
          },
          "functions": [],
          "resources": []
        }
      }
    },
    {
      "copy": {
        "name": "expressRouteCircuits_rbac",
        "count": "[length(parameters('roleAssignments'))]"
      },
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2019-10-01",
      "name": "[format('rbac-{0}{1}', deployment().name, copyIndex())]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "roleAssignmentObj": {
            "value": "[parameters('roleAssignments')[copyIndex()]]"
          },
          "builtInRoleNames": {
            "value": "[variables('builtInRoleNames')]"
          },
          "resourceName": {
            "value": "[parameters('circuitName')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.4.613.9944",
              "templateHash": "15849353736051911676"
            }
          },
          "parameters": {
            "roleAssignmentObj": {
              "type": "object"
            },
            "builtInRoleNames": {
              "type": "object"
            },
            "resourceName": {
              "type": "string"
            }
          },
          "functions": [],
          "resources": [
            {
              "copy": {
                "name": "roleAssigment",
                "count": "[length(parameters('roleAssignmentObj').principalIds)]"
              },
              "type": "Microsoft.Network/expressRouteCircuits/providers/roleAssignments",
              "apiVersion": "2020-04-01-preview",
              "name": "[format('{0}/Microsoft.Authorization/{1}', parameters('resourceName'), guid(parameters('resourceName'), parameters('roleAssignmentObj').principalIds[copyIndex()], parameters('roleAssignmentObj').roleDefinitionIdOrName))]",
              "properties": {
                "roleDefinitionId": "[if(contains(parameters('builtInRoleNames'), parameters('roleAssignmentObj').roleDefinitionIdOrName), parameters('builtInRoleNames')[parameters('roleAssignmentObj').roleDefinitionIdOrName], parameters('roleAssignmentObj').roleDefinitionIdOrName)]",
                "principalId": "[parameters('roleAssignmentObj').principalIds[copyIndex()]]"
              }
            }
          ]
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.Network/expressRouteCircuits', parameters('circuitName'))]"
      ]
    }
  ],
  "outputs": {
    "expressRouteCircuitResourceId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Network/expressRouteCircuits', parameters('circuitName'))]"
    },
    "expressRouteCircuitResourceGroup": {
      "type": "string",
      "value": "[resourceGroup().name]"
    },
    "expressRouteCircuitName": {
      "type": "string",
      "value": "[parameters('circuitName')]"
    },
    "expressRouteCircuitServiceKey": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.Network/expressRouteCircuits', parameters('circuitName')), '2020-05-01').serviceKey]"
    }
  }
}