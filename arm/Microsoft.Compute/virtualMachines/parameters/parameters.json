{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        // "vmNamePrefix": {
        //     "value": "iacs"
        // },
        // "vmNumberOfInstances": {
        //     "value": 2
        // },
        // "vmInitialNumber": {
        //     "value": 0
        // },
        // "managedServiceIdentity": {
        //     "value": "SystemAssigned"
        // },
        "virtualMachineName": {
            "value": "bicep-vm"
        },
        "imageReference": {
            "value": {
                "publisher": "MicrosoftWindowsServer",
                "offer": "WindowsServer",
                "sku": "2016-Datacenter",
                "version": "latest"
            }
        },
        "osDisk": {
            "value": {
                "createOption": "fromImage",
                "diskSizeGB": "128",
                "managedDisk": {
                    "storageAccountType": "Premium_LRS"
                }
            }
        },
        "adminUsername": {
            "value": "localAdminUser"
        },
        "adminPassword": {
            "reference": {
                "keyVault": {
                    "id": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/validation-rg/providers/Microsoft.KeyVault/vaults/adp-sxx-az-kv-weu-x-001"
                },
                "secretName": "adminPassword"
            }
        },
        "nicConfigurations": {
            "value": [
                {
                    "nicSuffix": "-nic-01",
                    "ipConfigurations": [
                        {
                            "name": "ipconfig1",
                            "subnetId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/dependencies-rg/providers/Microsoft.Network/virtualNetworks/sxx-az-vnet-weu-x-002/subnets/sxx-az-subnet-weu-x-001",
                            "pipConfiguration": {
                                "publicIpNameSuffix": "-pip-11",
                                "publicIPPrefixId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourcegroups/dependencies-rg/providers/microsoft.network/publicipprefixes/sxx-az-pippfx-weu-x-003"
                            }
                        },
                        {
                            "name": "ipconfig2",
                            "subnetId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/dependencies-rg/providers/Microsoft.Network/virtualNetworks/sxx-az-vnet-weu-x-002/subnets/sxx-az-subnet-weu-x-001",
                            "privateIPAllocationMethod": "Static",
                            "vmIPAddress": "10.0.0.7",
                            "pipConfiguration": {
                                "publicIpNameSuffix": "-pip-12",
                                "roleAssignments": [
                                    {
                                        "roleDefinitionIdOrName": "Reader",
                                        "principalIds": [
                                            "5545f7a0-51f4-46af-b3b4-baecf5176a56" // adp-sxx-az-msi-weu-x-001
                                        ]
                                    }
                                ]
                            }
                        },
                        {
                            "name": "ipconfig3",
                            "subnetId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/dependencies-rg/providers/Microsoft.Network/virtualNetworks/sxx-az-vnet-weu-x-002/subnets/sxx-az-subnet-weu-x-001",
                        }
                    ],
                    "nsgId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/validation-rg/providers/Microsoft.Network/networkSecurityGroups/sxx-az-nsg-weu-x-003",
                    "roleAssignments": [
                        {
                            "roleDefinitionIdOrName": "Reader",
                            "principalIds": [
                                "5545f7a0-51f4-46af-b3b4-baecf5176a56" // adp-sxx-az-msi-weu-x-001
                            ]
                        }
                    ]
                },
                {
                    "nicSuffix": "-nic-02",
                    "ipConfigurations": [
                        {
                            "name": "ipconfig1",
                            "subnetId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/dependencies-rg/providers/Microsoft.Network/virtualNetworks/sxx-az-vnet-weu-x-002/subnets/sxx-az-subnet-weu-x-001",
                            "pipConfiguration": {
                                "publicIpNameSuffix": "-pip-22"
                                // ,
                                // "publicIPAllocationMethod": "Dynamic",
                                // "skuName": "Basic"
                            }
                        },
                        {
                            "name": "ipconfig2",
                            "subnetId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/dependencies-rg/providers/Microsoft.Network/virtualNetworks/sxx-az-vnet-weu-x-002/subnets/sxx-az-subnet-weu-x-001",
                            "privateIPAllocationMethod": "Static",
                            "vmIPAddress": "10.0.0.9"
                        }
                    ]
                }
            ]
        },
        "extensionConfigurations": {
            "value": [
                {
                    "extensionName": "DependencyAgentWindows",
                    "publisher": "Microsoft.Azure.Monitoring.DependencyAgent",
                    "type": "DependencyAgentWindows",
                    "typeHandlerVersion": "9.5",
                    "autoUpgradeMinorVersion": true
                },
                {
                    "extensionName": "MicrosoftAntiMalwareSettings",
                    "publisher": "Microsoft.Azure.Security",
                    "type": "IaaSAntimalware",
                    "typeHandlerVersion": "1.3",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                        "AntimalwareEnabled": "true"
                    }
                },
                {
                    "extensionName": "WindowsDiskEncryption",
                    "publisher": "Microsoft.Azure.Security",
                    "type": "AzureDiskEncryption",
                    "typeHandlerVersion": "2.2",
                    "forceUpdateTag": "1.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                        "EncryptionOperation": "EnableEncryption",
                        "KeyVaultURL": "https://adp-sxx-az-kv-weu-x-001.vault.azure.net/",
                        "KeyVaultResourceId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/validation-rg/providers/Microsoft.KeyVault/vaults/adp-sxx-az-kv-weu-x-001",
                        "KeyEncryptionKeyURL": "https://adp-sxx-az-kv-weu-x-001.vault.azure.net/keys/keyEncryptionKey/685153483a1140e3856f004a753e1ab4",
                        "KekVaultResourceId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/validation-rg/providers/Microsoft.KeyVault/vaults/adp-sxx-az-kv-weu-x-001",
                        "KeyEncryptionAlgorithm": "RSA-OAEP", //'RSA-OAEP'/'RSA-OAEP-256'/'RSA1_5'
                        "VolumeType": "All", //'OS'/'Data'/'All'
                        "ResizeOSDisk": "false"
                    }
                },
                {
                    "extensionName": "NetworkWatcherAgentWindows",
                    "publisher": "Microsoft.Azure.NetworkWatcher",
                    "type": "NetworkWatcherAgentWindows",
                    "typeHandlerVersion": "1.4",
                    "autoUpgradeMinorVersion": true
                },
                {
                    "extensionName": "WindowsDsc",
                    "publisher": "Microsoft.Powershell",
                    "type": "DSC",
                    "typeHandlerVersion": "2.77",
                    "autoUpgradeMinorVersion": true
                }
                // ,
                // {
                //     "extensionName": "WindowsCustomScriptExtension",
                //     "publisher": "Microsoft.Compute",
                //     "type": "CustomScriptExtension",
                //     "typeHandlerVersion": "1.9",
                //     "autoUpgradeMinorVersion": true
                // }
                // ,
                // {
                //     "extensionName": "WindowsMMAAgent",
                //     "publisher": "Microsoft.EnterpriseCloud.Monitoring",
                //     "type": "MicrosoftMonitoringAgent",
                //     "typeHandlerVersion": "1.0",
                //     "autoUpgradeMinorVersion": true,
                //     "settings": {
                //         "workspaceId": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourcegroups/validation-rg/providers/microsoft.operationalinsights/workspaces/adp-sxx-az-la-weu-x-001"
                //     }
                // }
            ]
        },
        // "lock": {
        //     "value": "CanNotDelete"
        // },
        // "diagnosticSettingName": {
        //     "value": "testsetting"
        // },
        // "workspaceId": {
        //     "value": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourcegroups/validation-rg/providers/microsoft.operationalinsights/workspaces/adp-sxx-az-la-weu-x-001"
        // },
        // "diagnosticStorageAccountId": {
        //     "value": "/subscriptions/8629be3b-96bc-482d-a04b-ffff597c65a2/resourceGroups/validation-rg/providers/Microsoft.Storage/storageAccounts/adpsxxazsaweux001"
        // }
        // ,
        // "enableWindowsMMAAgent": {
        //     "value": true
        // },
        // "bootDiagnosticStorageAccountName": {
        //     "value": "adpsxxazsaweux001"
        // }
        "roleAssignments": {
            "value": [
                {
                    "roleDefinitionIdOrName": "Reader",
                    "principalIds": [
                        "5545f7a0-51f4-46af-b3b4-baecf5176a56" // adp-sxx-az-msi-weu-x-001
                    ]
                }
            ]
        }
    }
}
